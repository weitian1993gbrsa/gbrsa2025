<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Presentation Summary</title>

<style>
    body { margin:0; background:#f5f5f5; font-family:system-ui,sans-serif; }

    .top-bar {
        display:flex; justify-content:space-between; align-items:center;
        padding:12px 16px; background:white; border-bottom:2px solid #ddd;
        position:sticky; top:0; z-index:10;
    }

    .top-btn {
        padding:10px 20px; border-radius:6px;
        border:1px solid #ccc; background:white; cursor:pointer;
    }
    .submit-btn { background:#007bff; color:white; border:none; }

    .score-values {
        display:flex; justify-content:center; gap:60px;
        padding:12px 0; font-size:20px; font-weight:700;
    }

    .row {
        display:grid; grid-template-columns:1fr 2fr 1fr;
        gap:20px; align-items:center; margin:20px auto;
        max-width:900px; padding:0 16px;
    }

    .box-minus, .box-plus {
        height:110px; border-radius:8px;
        display:flex; justify-content:center; align-items:center;
        flex-direction:column; font-size:18px; color:#fff; cursor:pointer;
    }

    .box-minus { background:#d64545; }
    .box-plus  { background:#28c766; }

    .level-labels {
        display:grid; grid-template-columns:1fr 1fr 1fr;
        text-align:center; font-size:16px; font-weight:700;
        margin-bottom:6px;
    }

    .summary-slider { width:100%; accent-color:#008000; }
</style>
</head>

<body data-page="presentation-summary">

<div class="top-bar">
    <button class="top-btn" onclick="history.back()">Back</button>
    <h2>Presentation Summary</h2>
    <button class="top-btn submit-btn" id="submitBtn">Submit</button>
</div>

<div class="score-values">
    <div id="scoreText">Score (0.0)</div>
    <div id="missText">Misses (0)</div>
</div>

<div id="summaryContainer"></div>

<script>
const data = JSON.parse(localStorage.getItem("presentationPage1") || "{}");

function safe(n){ return isNaN(Number(n)) ? 0 : Number(n); }

const WEIGHTS = {
    cre: 0.15,
    mus: 0.20,
    ent: 0.25,
    form: 0.25,
    var: 0.15
};

const cats = [
    { key:"cre",  label:"Creativity",   minus:"creMinus",  plus:"crePlus" },
    { key:"mus",  label:"Musicality",   minus:"musMinus",  plus:"musPlus" },
    { key:"ent",  label:"Entertainment",minus:"entMinus",  plus:"entPlus" },
    { key:"form", label:"Form",         minus:"formMinus", plus:"formPlus"},
    { key:"var",  label:"Variety",      minus:"varMinus",  plus:"varPlus" }
];

const container = document.getElementById("summaryContainer");

cats.forEach(cat => {

    const minus = safe(data[cat.minus]);
    const plus  = safe(data[cat.plus]);

    let v = 12 + plus - minus;
    v = Math.max(0, Math.min(24, v));

    container.innerHTML += `
        <div class="row">

            <div class="box-minus" data-key="${cat.key}">
                ${cat.label} -
            </div>

            <div>
                <div class="level-labels">
                    <div>0</div><div id="val_${cat.key}">${v}</div><div>24</div>
                </div>
                <input id="slider_${cat.key}" type="range" min="0" max="24"
                       value="${v}" disabled class="summary-slider">
            </div>

            <div class="box-plus" data-key="${cat.key}">
                ${cat.label} +
            </div>

        </div>
    `;
});

let misses = safe(data.misses);

function recalcScore(){
    let score = 0;

    cats.forEach(cat=>{
        const v = Number(document.getElementById("slider_"+cat.key).value);
        score += v * WEIGHTS[cat.key];
    });

    score -= misses;

    document.getElementById("scoreText").textContent = `Score (${score.toFixed(1)})`;
}
recalcScore();

document.getElementById("missText").textContent = `Misses (${misses})`;

document.querySelectorAll(".box-minus").forEach(box=>{
    box.addEventListener("click", ()=>{
        const key = box.dataset.key;
        const slider = document.getElementById("slider_"+key);
        let v = Number(slider.value)-1;
        if(v<0) v=0;
        slider.value = v;
        document.getElementById("val_"+key).textContent = v;
        recalcScore();
    });
});

document.querySelectorAll(".box-plus").forEach(box=>{
    box.addEventListener("click", ()=>{
        const key = box.dataset.key;
        const slider = document.getElementById("slider_"+key);
        let v = Number(slider.value)+1;
        if(v>24) v=24;
        slider.value = v;
        document.getElementById("val_"+key).textContent = v;
        recalcScore();
    });
});

document.getElementById("submitBtn").addEventListener("click", ()=>{
    alert("FINAL SCORE SUBMITTED");
});
</script>

</body>
</html>
