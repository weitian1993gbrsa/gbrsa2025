<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>

<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Speed Judge</title>

<!-- Core scripts -->
<script defer src="./config.js"></script>
<script defer src="./app.js"></script>
<script defer src="./judge-core.js"></script>
<script defer src="./judge-forms.js"></script>

<script>
window.addEventListener("DOMContentLoaded", () => {
  const logic = initJudgeForm("speed");
  JudgeCore.init({
    judgeType: "speed",
    submitButton: document.querySelector(".np-enter"),
    buildScore: () => logic.getScore()
  });
});
</script>

<style>
/* GENERAL RESET + TOUCH SAFETY */
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  touch-action: manipulation;
}

html, body {
  margin:0;
  padding:0;
  background:#f5f7fb;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  -webkit-text-size-adjust:100%;
}

/* PAGE WRAPPER */
.page {
  display:flex;
  flex-direction:column;
}

/* ✅ FULL-WIDTH LAYOUT */
.container {
  width:100%;
  padding:1rem;
  margin:0;
  max-width:none;
}

/* ✅ REMOVE CARD LOOK */
.block {
  background:transparent;
  padding:0;
  margin:0;
  border-radius:0;
  box-shadow:none;
}

/* BUTTON BASE */
.btn {
  padding:0.75rem 1rem;
  border:1px solid #ddd;
  background:#fff;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
}

/* HEADER */
.judge-header {
  display:flex;
  align-items:center;
  gap:.75rem;
  padding:1rem;
  background:#ffffffd9;
  border-bottom:1px solid #e5e7eb;
  backdrop-filter: blur(4px);
  position:sticky;
  top:0;
  z-index:999;
}

.judge-title {
  font-size:1.4rem;
  font-weight:700;
}

/* FALSE START BTN */
.fs-btn {
  width:100%;
  padding:16px 0;
  margin-bottom:18px;
  font-size:20px;
  border-radius:8px;
  font-weight:700;
  text-align:center;
  border:none;
  color:#fff;
}

.fs-no { background:#22c55e; }
.fs-yes { background:#dc2626; }

/* SCORE DISPLAY */
.score-screen {
  width:100%;
  background:#ffffff;
  color:#111;
  font-size:3.4rem;
  text-align:center;
  padding:22px;
  border-radius:14px;
  margin-bottom:22px;
  font-family:monospace;
  letter-spacing:2px;
}

/* NUMPAD */
.numpad-grid {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  margin-bottom:20px;
}

.numpad-grid button {
  padding:20px 0;
  font-size:1.6rem;
  border-radius:12px;
  background:#fff;
  border:1px solid #ddd;
  font-weight:600;
}

.np-clear {
  background:#fee2e2;
  border-color:#fca5a5;
  color:#b91c1c;
}

.np-enter {
  background:#2563eb !important;
  color:#fff !important;
  border:1px solid #1d4ed8 !important;
  font-weight:700;
}

/* REMARK INPUT */
.remark-rounded {
  width:100%;
  padding:14px 16px;
  font-size:1rem;
  border:1px solid #d1d5db;
  border-radius:999px;
  background:#fff;
  margin-bottom:20px;
}

.remark-rounded:focus {
  border-color:#2563eb;
}

.remark-rounded::placeholder {
  color:#9ca3af;
}

/* SUBMIT OVERLAY */
.overlay {
  position:fixed;
  inset:0;
  z-index:9999;
  background:rgba(255,255,255,0.85);
  display:flex;
  justify-content:center;
  align-items:center;
}

.overlay.hide { display:none !important; }

.overlay-card {
  background:#fff;
  padding:1.25rem 1.5rem;
  border-radius:16px;
  box-shadow:0 10px 30px #0002;
  border:1px solid #e5e7eb;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:.75rem;
}

.overlay-text {
  font-weight:700;
  color:#111827;
}

.loading {
  display:flex;
  align-items:center;
  gap:.5rem;
}

.loading .dot {
  width:6px;
  height:6px;
  border-radius:50%;
  background:#9ca3af;
  animation:blink 1s infinite ease-in-out;
}

.loading .dot:nth-child(2) { animation-delay:.15s }
.loading .dot:nth-child(3) { animation-delay:.3s }

@keyframes blink {
  0%,80%,100% { transform:scale(0); opacity:.3; }
  40% { transform:scale(1); opacity:1; }
}
</style>
</head>

<body class="page judge">

<header class="judge-header">
  <button onclick="goBack()" class="btn">Back</button>
  <div class="judge-title">Unofficial Score</div>
</header>

<main class="container">
  <section class="block">
    <form id="scoreForm" class="form">

      <button type="button" id="falseStartBtn" class="fs-btn fs-no">False Start: No</button>
      <input type="hidden" id="falseStartVal" name="FALSE START" value="">

      <div id="scoreScreen" class="score-screen">0</div>

      <div class="numpad-grid">
        <button type="button" data-key="1">1</button>
        <button type="button" data-key="2">2</button>
        <button type="button" data-key="3">3</button>
        <button type="button" data-key="4">4</button>
        <button type="button" data-key="5">5</button>
        <button type="button" data-key="6">6</button>
        <button type="button" data-key="7">7</button>
        <button type="button" data-key="8">8</button>
        <button type="button" data-key="9">9</button>
        <button type="button" class="np-clear" data-key="clear">Clear</button>
        <button type="button" data-key="0">0</button>
        <button type="button" class="np-enter">Submit</button>
      </div>

      <input type="text" id="remarkText" class="remark-rounded" placeholder="Enter remark…">
      <input type="hidden" name="REMARK" id="remarkField">

      <!-- Hidden backend fields -->
      <input type="hidden" name="ID" id="fID">
      <input type="hidden" name="NAME1" id="fNAME1">
      <input type="hidden" name="NAME2" id="fNAME2">
      <input type="hidden" name="NAME3" id="fNAME3">
      <input type="hidden" name="NAME4" id="fNAME4">
      <input type="hidden" name="TEAM" id="fTEAM">
      <input type="hidden" name="STATE" id="fSTATE">
      <input type="hidden" name="HEAT" id="fHEAT">
      <input type="hidden" name="STATION" id="fSTATION">
      <input type="hidden" name="EVENT" id="fEVENT">
      <input type="hidden" name="DIVISION" id="fDIVISION">

    </form>
  </section>
</main>

<script>
function goBack() {
  const p = new URLSearchParams(location.search);
  location.href = `speed-station.html?station=${p.get("station")}&key=${p.get("key")}`;
}

history.pushState(null,null,location.href);
window.onpopstate = () => goBack();
</script>

<div id="submitOverlay" class="overlay hide">
  <div class="overlay-card">
    <div class="loading">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
    <div id="overlayText" class="overlay-text">Submitting…</div>
  </div>
</div>

<script>
const remarkText = document.getElementById("remarkText");
const remarkField = document.getElementById("remarkField");

remarkText.addEventListener("input", () => {
  remarkField.value = remarkText.value.trim();
});
</script>

</body>
</html>
