<!doctype html>
<html lang="en">
<head>
<meta name="format-detection" content="telephone=no">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>GBRSA Score â€¢ Scoring</title>

<!-- CSS -->
<link rel="stylesheet" href="./styles.css"/>

<!-- ðŸ”¥ PREFETCH (Speed Boost) -->
<link rel="prefetch" href="speed-judge.html">
<link rel="prefetch" href="speed-judge.js">
<link rel="prefetch" href="styles.css">
<link rel="prefetch" href="speed-station.html">

<!-- Load config first -->
<script src="./config.js"></script>

<!-- Other scripts -->
<script defer src="./app.js"></script>
<script defer src="./nozoom.js"></script>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1020">

<style>
  html, body { touch-action: manipulation; }

  /* FIX â€” Judge Login Card Should Not Glow */
  .judge-login {
    cursor: default !important;
    box-shadow: none !important;
    border-left: none !important;
    transition: none !important;
    outline: none !important;
  }

  .judge-login:hover {
    cursor: default !important;
    transform: none !important;
    outline: none !important;
    box-shadow: none !important;
  }

  .judge-login input:focus,
  .judge-login button:focus {
    outline: none !important;
    box-shadow: none !important;
    border-color: var(--border) !important;
  }

/* Prevent body scrolling */
html, body {
    overflow: hidden !important;
    position: fixed !important;
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}

/* Universal iOS scroll wrapper */
.ios-scroll-wrapper {
    position: relative;
    overflow-y: auto;
    height: calc(100vh - 80px); /* adjust if needed depending header height */
    -webkit-overflow-scrolling: touch; /* required for iOS smooth scroll */
}

</style>

<!-- API Warm-Up -->
<script>
fetch(window.CONFIG.APPS_SCRIPT_URL + "?warmup=1").catch(()=>{});
</script>

<!-- iOS zoom fix -->
<script>
(function(){
  function ensureSize(el){
    try{
      if(!el) return;
      let t = el.tagName.toLowerCase();
      if (t==='input' || t==='textarea' || t==='select'){
        el.style.fontSize='16px';
        el.style.webkitTextSizeAdjust='100%';
      }
    }catch(e){}
  }
  document.addEventListener('focusin', e => ensureSize(e.target), true);
})();
</script>

</head>

<body class="page homepage">

<header class="topbar">
  <img src="./assets/company-logo.png" alt="GBRSA" class="logo" />
  <div class="titles">
    <h1>GBRSA RopeApp</h1>
    <p class="subtitle">powered by GBRSA</p>
  </div>
</header>

<main class="page-wrapper">
  <div class="home-wrapper">

    <div class="menu-grid">

      <!-- Judge login ONLY -->
      <div class="card judge-login">
        <h3>Judge Access</h3>
        <p class="judge-desc">Enter your assigned access code to open your duty.</p>

        <div class="login-field">
          <input id="judgeKey" class="input" placeholder="Enter access code" type="password">
          <button class="btn primary" id="btnJudgeLogin">Enter</button>
        </div>

        <p id="keyError" class="judge-error">Invalid access code.</p>
      </div>

    </div>

  </div>
</main>

<footer class="foot" style="text-align:center;">
  <small>Â© 2025 GB Rope Skipping Academy</small>
</footer>

<script>
/* ============================================================
   CLEAR ALL CACHE ON LOGOUT / PAGE OPEN
   (Speed + Freestyle)
============================================================ */
Object.keys(localStorage).forEach(k => {
  if (k.startsWith("station_cache_")) {
    localStorage.removeItem(k);
  }
  if (k.startsWith("freestyle_cache_")) {
    localStorage.removeItem(k);
  }
});

const JUDGE_MAP = window.JUDGE_KEYS;

// UI elements
const keyInput  = document.getElementById("judgeKey");
const keyError  = document.getElementById("keyError");
const btnLogin  = document.getElementById("btnJudgeLogin");

btnLogin.addEventListener("click", () => {

  const key = keyInput.value.trim();
  keyError.style.display = "none";

  // Admin
  if (typeof ADMIN_KEY !== "undefined" && key === ADMIN_KEY) {
    btnLogin.disabled = true;
    btnLogin.textContent = "Loadingâ€¦";
    window.location.href = "admin.html";
    return;
  }

  // Judge key info
  const info = JUDGE_MAP[key];
  if (!info) {
    keyError.style.display = "block";
    return;
  }

  const station = info.station;
  const event = info.event;
  const judgeType = info.judgeType || "";

  btnLogin.disabled = true;
  btnLogin.textContent = "Loadingâ€¦";

  // â­ SPEED â†’ go to speed-station
  if (event === "speed") {
    location.href = `speed-station.html?station=${station}&key=${key}`;
    return;
  }

  // â­ FREESTYLE â†’ go to freestyle-station
  if (event === "freestyle") {
    location.href =
      `freestyle-station.html?station=${station}&judgeType=${judgeType}&key=${key}`;
    return;
  }
});

// Enter key support
keyInput.addEventListener("keyup", e => {
  if (e.key === "Enter") btnLogin.click();
});

// Reset after back
function resetJudgeLogin() {
  btnLogin.disabled = false;
  btnLogin.textContent = "Enter";
  keyError.style.display = "none";
  keyInput.value = "";
}

window.addEventListener("pageshow", resetJudgeLogin);
document.addEventListener("visibilitychange", () => {
  if (document.visibilityState === "visible") resetJudgeLogin();
});
window.addEventListener("pagehide", () => {
  keyInput.value = "";
});
</script>

</body>
</html>
